@page "/customers/create"
@using LIT.Smabu.Domain.Shared.Customers;
@using LIT.Smabu.Shared.Customers;
@using Microsoft.AspNetCore.Authorization;
@inject HttpClient Http
@attribute [Authorize]


<MudContainer Class="mt-8">
    <MudStack Row Justify="Justify.SpaceBetween">
         <MudText Typo="Typo.h6">Kunde erstellen</MudText>
         <MudButtonGroup>

         </MudButtonGroup>
     </MudStack>

    <MudForm @ref="form" @bind-IsValid="@success" @bind-Errors="@errors">
        <MudGrid>
            <MudItem xs="12">
                <MudTextField Label="Name" Required="true" @bind-Value="@Model.Name" />
            </MudItem>
            <MudItem xs="12">
                <MudButtonGroup>
                    <MudIconButton Icon="@Icons.Material.Filled.Cancel" Color="Color.Default" Href="/customers" />
                    <MudIconButton Icon="@Icons.Material.Filled.Save" Color="Color.Success" Disabled="@(!success)" OnClick="@SubmitAsync" />
                </MudButtonGroup>
            </MudItem>
        </MudGrid>
    </MudForm>
</MudContainer>

@code {
    @inject NavigationManager NavigationManager;
    bool success;
    string[] errors = { };
    MudForm form;

    public CreateCustomerDTO Model { get; } = new()
    { 
        Id = new CustomerId(Guid.NewGuid()),
        Name = ""
    };

    private async Task SubmitAsync()
    {
        using var response = await Http.PostAsJsonAsync("Customers", Model);
        NavigationManager.NavigateTo("/customers/" + Model.Id);
    }
}