@page "/customers/{Id:guid}"
@using LIT.Smabu.Domain.Shared.Common;
@using LIT.Smabu.Shared.Customers;
@using Microsoft.AspNetCore.Authorization;

@inject HttpClient Http
@attribute [Authorize]

<MudContainer Class="mt-8">
    <MudStack Row Justify="Justify.SpaceBetween">
         <MudText Typo="Typo.h6">@("Kunde " + @Model?.Name)</MudText>
            <MudButtonGroup>

            </MudButtonGroup>
        </MudStack>

        <MudForm @ref="form" @bind-IsValid="@success" @bind-Errors="@errors">
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudTextField Label="Name" Required @bind-Value="Model.Name" />
             </MudItem>
             <MudItem xs="12" sm="6">
                 <MudTextField Label="Branche" @bind-Value="Model.IndustryBranch" />
             </MudItem>
             <MudItem xs="12">
                 <MudButtonGroup>
                     <MudIconButton Icon="@Icons.Material.Filled.Cancel" Color="Color.Default" Href="/customers" />
                     <MudIconButton Icon="@Icons.Material.Filled.Save" Color="Color.Success" Disabled="@(!success)" OnClick="@SubmitAsync" />
                 </MudButtonGroup>
             </MudItem>
         </MudGrid>
     </MudForm>
 </MudContainer>

@code {
    @inject NavigationManager NavigationManager;
    bool success;
    string[] errors = { };
    MudForm form;

    [Parameter]
    public Guid Id { get; set; }
    public CustomerDTO Model { get; set; }

    protected override async Task OnInitializedAsync()
    {
        this.Model = await Http.GetFromJsonAsync<CustomerDTO>("Customers/" + Id) ?? throw new Exception("NotFound");
    }

    private async Task SubmitAsync()
    {
        using var response = await Http.PutAsJsonAsync("Customers/" + Id, this.Model);
        NavigationManager.NavigateTo("/customers");
    }
}