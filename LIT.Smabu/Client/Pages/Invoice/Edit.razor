@page "/invoices/{Id:guid}"
@using LIT.Smabu.Domain.Shared.Common;
@using LIT.Smabu.Shared.Customers;
@using LIT.Smabu.Shared.Invoices;
@using Microsoft.AspNetCore.Authorization;

@inject HttpClient Http
@attribute [Authorize]

<MudContainer Class="mt-8">
    <MudStack Row Justify="Justify.SpaceBetween">
         <MudText Typo="Typo.h6">@("Rechnung " + @Model?.DisplayName)</MudText>
         <MudButtonGroup>

         </MudButtonGroup>
     </MudStack>

     <MudForm @ref="form" @bind-IsValid="@success" @bind-Errors="@errors">
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudTextField Label="#" ReadOnly Value="@Model.Number.ToShortString()" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudTextField Label="Kunde" ReadOnly Value="@Model.Customer.Name" />
                </MudItem>
             <MudItem xs="12">
                 <MudButtonGroup>
                     <MudIconButton Icon="@Icons.Material.Filled.Cancel" Color="Color.Default" Href="/invoices" />
                     <MudIconButton Icon="@Icons.Material.Filled.Save" Color="Color.Success" Disabled="@(!success)" OnClick="@SubmitAsync" />
                 </MudButtonGroup>
             </MudItem>
         </MudGrid>
     </MudForm>
 </MudContainer>

@code {
    @inject NavigationManager NavigationManager;
    bool success;
    string[] errors = { };
    MudForm form;

    [Parameter]
    public Guid Id { get; set; }
    public InvoiceDTO Model { get; set; }

    protected override async Task OnInitializedAsync()
    {
        this.Model = await Http.GetFromJsonAsync<InvoiceDTO>("Invoices/" + Id) ?? throw new Exception("NotFound");
    }

    private async Task SubmitAsync()
    {
        using var response = await Http.PutAsJsonAsync("Invoices/" + Id, this.Model);
        NavigationManager.NavigateTo("/invoices");
    }
}